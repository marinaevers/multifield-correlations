{"version":3,"sources":["webpack:///./src/lib/components/CorrelationHeatmap.js"],"names":["CorrelationHeatmapD3","el","props","update","bind","drawHeatmap","svg","d3","append","attr","width","margin","height","x","range","domain","segmentIDs","padding","y","reverse","tickwidth","length","call","selectAll","data","d","cmap","substring","indexOf","tickheight","zoom","on","handleZoom","e","transform","myColor","kde","kernel","thresholds","map","t","epanechnikov","bandwidth","Math","abs","id1","id2","enter","style","total","i","transition","duration","setProps","hoverData","showDistribution","xDens","ticks","densities","correlations","yDens","line","curve","xd","yd","datum","legendProps","title","colorBarTitle","tickSize","marginTop","marginRight","marginBottom","marginLeft","ramp","color","n","canvas","document","createElement","context","getContext","fillStyle","fillRect","min","xColorScale","copy","rangeRound","toDataURL","legendTitle","fontSize","g","select","remove","text"],"mappings":"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","file":"1f4d446-main-wps-hmr.js","sourcesContent":["import * as d3 from 'd3'\nexport default class CorrelationHeatmapD3 {\n    constructor(el, props) {\n        this.props = props;\n        this.update = this.update.bind(this);\n        this.drawHeatmap = this.drawHeatmap.bind(this);\n\n        this.svg = d3.select(el).append('svg')\n            .attr(\"width\", props.width+3*props.margin)\n            .attr(\"height\", props.height+2*props.margin)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + props.margin + \",\" + props.margin + \")\");\n\n        this.drawHeatmap();\n    }\n\n    drawHeatmap() {\n        // Axes heatmap\n        const x = d3.scaleBand()\n            .range([0, this.props.width])\n            .domain(this.props.segmentIDs)\n            .padding(0.01);\n        const y = d3.scaleBand()\n            .range([0, this.props.height])\n            .domain(this.props.segmentIDs.reverse())\n            .padding(0.01);\n\n        // Add axes\n        const tickwidth = this.props.width/this.props.segmentIDs.length\n        this.svg.append(\"g\")\n            .attr(\"transform\", \"translate(0, \" + this.props.height + \")\")\n            .call(d3.axisBottom(x))\n            .selectAll(\".tick\")\n            .data(this.props.segmentIDs.reverse())\n            .append(\"rect\")\n            .attr(\"width\", tickwidth)\n            .attr(\"height\", 5)\n            .attr(\"transform\", \"translate(\" + (-0.5)*tickwidth + \", 0)\")\n            .attr(\"fill\", d => this.props.cmap[d.substring(0, d.indexOf(' '))])\n\n        const tickheight = this.props.height/this.props.segmentIDs.length\n        this.svg.append(\"g\")\n            .call(d3.axisLeft(y))\n            .selectAll(\".tick\")\n            .data(this.props.segmentIDs.reverse())\n            .append(\"rect\")\n            .attr(\"width\", 5)\n            .attr(\"height\", tickheight)\n            .attr(\"transform\", \"translate(-5, \" + (-0.5)*tickheight + \")\")\n            .attr(\"fill\", d => this.props.cmap[d.substring(0, d.indexOf(' '))])\n\n        this.svg.selectAll(\".tick text\")\n            .attr(\"font-size\", 0);\n\n        // Introduce Zoom\n        const zoom = d3.zoom()\n            .on('zoom', handleZoom);\n\n\n        const svg = this.svg;\n        function handleZoom(e) {\n            svg\n                .attr('transform', e.transform)\n        }\n\n        // Build color scale\n        const myColor = d3.scaleSequential(d3.interpolateRdBu)\n            .domain([1, -1]);\n\n        function kde(kernel, thresholds, data) {\n            return thresholds.map(t => [t, d3.mean(data, d => kernel(t - d))]);\n        }\n\n        function epanechnikov(bandwidth) {\n            return x => Math.abs(x /= bandwidth) <= 1 ? 0.75 * (1 - x * x) / bandwidth : 0;\n        }\n\n        // TODO: Select suitable value\n        const bandwidth = 0.05;\n\n        const props = this.props;\n\n        // draw heatmap\n        this.svg.selectAll()\n            .data(this.props.data, function(d) {return d.id1+\":\"+d.id2})\n            .enter()\n            .append(\"rect\")\n            .attr(\"x\", function(d) {return x(d.id1)})\n            .attr(\"y\", function(d) {return y(d.id2)})\n            .attr(\"width\", x.bandwidth())\n            .attr(\"height\", y.bandwidth())\n            .style(\"fill\", function(d) {return myColor(d.total)})\n            .attr(\"opacity\", 0.5)\n            .on('mouseover', function (d, i) {\n                d3.select(this).transition()\n                    .duration('50').attr('opacity', '.85');\n                props.setProps({hoverData:[i.id1, i.id2]})\n            })\n            .on('mouseout', function (d, i) {\n                d3.select(this).transition()\n                    .duration('50').attr('opacity', '.5')});\n        if(this.props.showDistribution) {\n            for (const i in this.props.data) {\n                const d = this.props.data[i];\n                const xDens = d3.scaleLinear()\n                    .range([x(d.id1), x(d.id1) + x.bandwidth()])\n                    .domain([-1, 1]);\n                const thresholds = xDens.ticks(50);\n                const densities = kde(epanechnikov(bandwidth), thresholds, d.correlations);\n                const yDens = d3.scaleLinear()\n                    .range([y(d.id2), y(d.id2) + y.bandwidth()])\n                    .domain([10, 0]); //d.correlations.length*0.75\n                const line = d3.line()\n                    .curve(d3.curveBasis)\n                    .x(xd => xDens(xd[0]))\n                    .y(yd => yDens(yd[1]));\n                this.svg\n                    .append(\"path\")\n                    .datum(densities)\n                    .attr(\"fill\", \"none\")\n                    .attr(\"stroke\", \"#000\")\n                    .attr(\"stroke-width\", 1.5)\n                    .attr(\"stroke-linejoin\", \"round\")\n                    .attr(\"d\", line);\n            }\n        }\n\n        // Color bar\n        const legendProps = {\n            title: this.props.colorBarTitle, tickSize: 6, width: 30, height: this.props.height,// + tickSize,\n            marginTop: 0, marginRight: 0, marginBottom: 0,// + tickSize,\n            marginLeft: 3, ticks: this.props.width / 64\n        };\n\n        function ramp(color, n = 256) {\n            const canvas = document.createElement(\"canvas\");\n            canvas.width = 1;\n            canvas.height = n;\n            const context = canvas.getContext(\"2d\");\n            for (let i = 0; i < n; ++i) {\n                context.fillStyle = color(i / (n - 1));\n                context.fillRect(0, /*n - 1 - i, 1*/i,1, 1);\n            }\n            return canvas;\n        }\n\n        const n = Math.min(myColor.domain().length, myColor.range().length);\n        const xColorScale = myColor.copy().rangeRound(d3.quantize(d3.interpolate(legendProps.marginTop, legendProps.height - legendProps.marginBottom), n));\n        this.svg.append(\"image\")\n            .attr(\"x\", this.props.width + legendProps.marginLeft)\n            .attr(\"y\", legendProps.marginTop)\n            .attr(\"width\", legendProps.width - legendProps.marginLeft - legendProps.marginRight)\n            .attr(\"height\", legendProps.height - legendProps.marginTop - legendProps.marginBottom)\n            .attr(\"preserveAspectRatio\", \"none\")\n            .attr(\"xlink:href\", ramp(myColor.copy().domain(d3.quantize(d3.interpolate(0, 1), n))).toDataURL())\n            .style(\"opacity\", 0.5);\n        this.legendTitle = this.svg.append(\"g\")\n            .style(\"font\", this.props.fontSize + \"px times\")\n            .attr(\"transform\", 'translate(' + (this.props.width+legendProps.width) + ',0)') // myColor + legendProps.width\n            .call(d3.axisRight(xColorScale))\n            .call(g => g.select(\".domain\").remove())\n            .append(\"text\")\n            .attr(\"x\", -legendProps.width + legendProps.marginLeft)\n            .attr(\"y\", -5)\n            .attr(\"fill\", \"black\")\n            .attr(\"text-anchor\", \"start\")\n            .attr(\"font-size\", this.props.fontSize)\n            .text(legendProps.title);\n\n        this.svg.call(zoom);\n    }\n\n    update(props) {\n        this.props = props;\n        this.svg.selectAll('*').remove();\n        this.drawHeatmap();\n    }\n}"],"sourceRoot":""}