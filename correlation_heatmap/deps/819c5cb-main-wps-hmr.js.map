{"version":3,"sources":["webpack:///./src/lib/components/CorrelationHeatmap.js"],"names":["CorrelationHeatmapD3","el","props","update","bind","drawHeatmap","svg","d3","append","attr","width","margin","height","x","range","domain","segmentIDs","padding","y","reverse","tickwidth","length","call","selectAll","data","d","cmap","substring","indexOf","tickheight","myColor","kde","kernel","thresholds","map","t","epanechnikov","bandwidth","Math","abs","id1","id2","enter","style","total","on","i","transition","duration","setProps","hoverData","showDistribution","xDens","ticks","densities","correlations","yDens","line","curve","xd","yd","datum","legendProps","title","colorBarTitle","tickSize","marginTop","marginRight","marginBottom","marginLeft","ramp","color","n","canvas","document","createElement","context","getContext","fillStyle","fillRect","min","xColorScale","copy","rangeRound","toDataURL","legendTitle","fontSize","g","select","remove","text"],"mappings":"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","file":"819c5cb-main-wps-hmr.js","sourcesContent":["import * as d3 from 'd3'\nexport default class CorrelationHeatmapD3 {\n    constructor(el, props) {\n        this.props = props;\n        this.update = this.update.bind(this);\n        this.drawHeatmap = this.drawHeatmap.bind(this);\n\n        this.svg = d3.select(el).append('svg')\n            .attr(\"width\", props.width+3*props.margin)\n            .attr(\"height\", props.height+2*props.margin)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + props.margin + \",\" + props.margin + \")\");\n\n        this.drawHeatmap();\n    }\n\n    drawHeatmap() {\n        // Axes heatmap\n        const x = d3.scaleBand()\n            .range([0, this.props.width])\n            .domain(this.props.segmentIDs)\n            .padding(0.01);\n        const y = d3.scaleBand()\n            .range([0, this.props.height])\n            .domain(this.props.segmentIDs.reverse())\n            .padding(0.01);\n\n        // Add axes\n        const tickwidth = this.props.width/this.props.segmentIDs.length\n        this.svg.append(\"g\")\n            .attr(\"transform\", \"translate(0, \" + this.props.height + \")\")\n            .call(d3.axisBottom(x))\n            .selectAll(\".tick\")\n            .data(this.props.segmentIDs.reverse())\n            .append(\"rect\")\n            .attr(\"width\", tickwidth)\n            .attr(\"height\", 5)\n            .attr(\"transform\", \"translate(\" + (-0.5)*tickwidth + \", 0)\")\n            .attr(\"fill\", d => this.props.cmap[d.substring(0, d.indexOf(' '))])\n\n        const tickheight = this.props.height/this.props.segmentIDs.length\n        this.svg.append(\"g\")\n            .call(d3.axisLeft(y))\n            .selectAll(\".tick\")\n            .data(this.props.segmentIDs.reverse())\n            .append(\"rect\")\n            .attr(\"width\", 5)\n            .attr(\"height\", tickheight)\n            .attr(\"transform\", \"translate(-5, \" + (-0.5)*tickheight + \")\")\n            .attr(\"fill\", d => this.props.cmap[d.substring(0, d.indexOf(' '))])\n\n        this.svg.selectAll(\".tick text\")\n            .attr(\"font-size\", 0);\n\n\n\n        // Build color scale\n        const myColor = d3.scaleSequential(d3.interpolateRdBu)\n            .domain([1, -1]);\n\n        function kde(kernel, thresholds, data) {\n            return thresholds.map(t => [t, d3.mean(data, d => kernel(t - d))]);\n        }\n\n        function epanechnikov(bandwidth) {\n            return x => Math.abs(x /= bandwidth) <= 1 ? 0.75 * (1 - x * x) / bandwidth : 0;\n        }\n\n        // TODO: Select suitable value\n        const bandwidth = 0.05;\n\n        const props = this.props;\n\n        // draw heatmap\n        this.svg.selectAll()\n            .data(this.props.data, function(d) {return d.id1+\":\"+d.id2})\n            .enter()\n            .append(\"rect\")\n            .attr(\"x\", function(d) {return x(d.id1)})\n            .attr(\"y\", function(d) {return y(d.id2)})\n            .attr(\"width\", x.bandwidth())\n            .attr(\"height\", y.bandwidth())\n            .style(\"fill\", function(d) {return myColor(d.total)})\n            .attr(\"opacity\", 0.5)\n            .on('mouseover', function (d, i) {\n                d3.select(this).transition()\n                    .duration('50').attr('opacity', '.85');\n                props.setProps({hoverData:[i.id1, i.id2]})\n            })\n            .on('mouseout', function (d, i) {\n                d3.select(this).transition()\n                    .duration('50').attr('opacity', '.5')});\n        if(this.props.showDistribution) {\n            for (const i in this.props.data) {\n                const d = this.props.data[i];\n                const xDens = d3.scaleLinear()\n                    .range([x(d.id1), x(d.id1) + x.bandwidth()])\n                    .domain([-1, 1]);\n                const thresholds = xDens.ticks(50);\n                const densities = kde(epanechnikov(bandwidth), thresholds, d.correlations);\n                const yDens = d3.scaleLinear()\n                    .range([y(d.id2), y(d.id2) + y.bandwidth()])\n                    .domain([10, 0]); //d.correlations.length*0.75\n                const line = d3.line()\n                    .curve(d3.curveBasis)\n                    .x(xd => xDens(xd[0]))\n                    .y(yd => yDens(yd[1]));\n                this.svg\n                    .append(\"path\")\n                    .datum(densities)\n                    .attr(\"fill\", \"none\")\n                    .attr(\"stroke\", \"#000\")\n                    .attr(\"stroke-width\", 1.5)\n                    .attr(\"stroke-linejoin\", \"round\")\n                    .attr(\"d\", line);\n            }\n        }\n\n        // Color bar\n        const legendProps = {\n            title: this.props.colorBarTitle, tickSize: 6, width: 30, height: this.props.height,// + tickSize,\n            marginTop: 0, marginRight: 0, marginBottom: 0,// + tickSize,\n            marginLeft: 3, ticks: this.props.width / 64\n        };\n\n        function ramp(color, n = 256) {\n            const canvas = document.createElement(\"canvas\");\n            canvas.width = 1;\n            canvas.height = n;\n            const context = canvas.getContext(\"2d\");\n            for (let i = 0; i < n; ++i) {\n                context.fillStyle = color(i / (n - 1));\n                context.fillRect(0, /*n - 1 - i, 1*/i,1, 1);\n            }\n            return canvas;\n        }\n\n        const n = Math.min(myColor.domain().length, myColor.range().length);\n        const xColorScale = myColor.copy().rangeRound(d3.quantize(d3.interpolate(legendProps.marginTop, legendProps.height - legendProps.marginBottom), n));\n        this.svg.append(\"image\")\n            .attr(\"x\", this.props.width + legendProps.marginLeft)\n            .attr(\"y\", legendProps.marginTop)\n            .attr(\"width\", legendProps.width - legendProps.marginLeft - legendProps.marginRight)\n            .attr(\"height\", legendProps.height - legendProps.marginTop - legendProps.marginBottom)\n            .attr(\"preserveAspectRatio\", \"none\")\n            .attr(\"xlink:href\", ramp(myColor.copy().domain(d3.quantize(d3.interpolate(0, 1), n))).toDataURL())\n            .style(\"opacity\", 0.5);\n        this.legendTitle = this.svg.append(\"g\")\n            .style(\"font\", this.props.fontSize + \"px times\")\n            .attr(\"transform\", 'translate(' + (this.props.width+legendProps.width) + ',0)') // myColor + legendProps.width\n            .call(d3.axisRight(xColorScale))\n            .call(g => g.select(\".domain\").remove())\n            .append(\"text\")\n            .attr(\"x\", -legendProps.width + legendProps.marginLeft)\n            .attr(\"y\", -5)\n            .attr(\"fill\", \"black\")\n            .attr(\"text-anchor\", \"start\")\n            .attr(\"font-size\", this.props.fontSize)\n            .text(legendProps.title);\n\n\n    }\n\n    update(props) {\n        this.props = props;\n        this.svg.selectAll('*').remove();\n        this.drawHeatmap();\n    }\n}"],"sourceRoot":""}