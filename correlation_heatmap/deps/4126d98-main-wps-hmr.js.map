{"version":3,"sources":["webpack:///./src/lib/components/CorrelationHeatmap.js"],"names":["CorrelationHeatmapD3","el","props","update","bind","drawHeatmap","svg","d3","append","attr","width","margin","height","x","range","domain","segmentIDs","padding","y","reverse","call","myColor","kde","kernel","thresholds","data","map","t","d","epanechnikov","bandwidth","Math","abs","selectAll","id1","id2","enter","style","total","i","xDens","ticks","densities","correlations","console","log","yDens","length","line","curve","xd","yd","datum","legendProps","title","colorBarTitle","tickSize","marginTop","marginRight","marginBottom","marginLeft","ramp","color","n","canvas","document","createElement","context","getContext","fillStyle","fillRect","min","xColorScale","copy","rangeRound","toDataURL","legendTitle","fontSize","g","select","remove","text"],"mappings":"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","file":"4126d98-main-wps-hmr.js","sourcesContent":["import * as d3 from 'd3'\nexport default class CorrelationHeatmapD3 {\n    constructor(el, props) {\n        this.props = props;\n        this.update = this.update.bind(this);\n        this.drawHeatmap = this.drawHeatmap.bind(this);\n\n        this.svg = d3.select(el).append('svg')\n            .attr(\"width\", props.width+3*props.margin)\n            .attr(\"height\", props.height+2*props.margin)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + props.margin + \",\" + props.margin + \")\");\n\n        this.drawHeatmap();\n    }\n\n    drawHeatmap() {\n        // Axes heatmap\n        const x = d3.scaleBand()\n            .range([0, this.props.width])\n            .domain(this.props.segmentIDs)\n            .padding(0.01);\n        const y = d3.scaleBand()\n            .range([0, this.props.height])\n            .domain(this.props.segmentIDs.reverse())\n            .padding(0.01);\n\n        // Add axes\n        this.svg.append(\"g\")\n            .attr(\"transform\", \"translate(0, \" + this.props.height + \")\")\n            .call(d3.axisBottom(x));\n        this.svg.append(\"g\")\n            .call(d3.axisLeft(y));\n\n        // Build color scale\n        const myColor = d3.scaleSequential(d3.interpolateRdBu)\n            .domain([1, -1]);\n\n        function kde(kernel, thresholds, data) {\n            return thresholds.map(t => [t, d3.mean(data, d => kernel(t - d))]);\n        }\n\n        function epanechnikov(bandwidth) {\n            return x => Math.abs(x /= bandwidth) <= 1 ? 0.75 * (1 - x * x) / bandwidth : 0;\n        }\n\n        // TODO: Select suitable value\n        const bandwidth = 0.1;\n\n        // draw heatmap\n        this.svg.selectAll()\n            .data(this.props.data, function(d) {return d.id1+\":\"+d.id2})\n            .enter()\n            .append(\"rect\")\n            .attr(\"x\", function(d) {return x(d.id1)})\n            .attr(\"y\", function(d) {return y(d.id2)})\n            .attr(\"width\", x.bandwidth())\n            .attr(\"height\", y.bandwidth())\n            .style(\"fill\", function(d) {return myColor(d.total)})\n            .style(\"opacity\", 0.5);\n        for(const i in this.props.data) {\n            const d = this.props.data[i];\n            const xDens = d3.scaleLinear()\n                .range([x(d.id1), x(d.id1)+x.bandwidth()])\n                .domain([-1, 1]);\n            const thresholds = xDens.ticks(50);\n            const densities = kde(epanechnikov(bandwidth), thresholds, d.correlations);\n            console.log(densities);\n            const yDens = d3.scaleLinear()\n                .range([y(d.id2), y(d.id2)+y.bandwidth()])\n                .domain([d.correlations.length*0.75, 0]);\n            const line = d3.line()\n                .curve(d3.curveBasis)\n                .x(xd => xDens(xd[0]))\n                .y(yd => yDens(yd[1]));\n            this.svg\n                .append(\"path\")\n                .datum(densities)\n                .attr(\"fill\", \"none\")\n                .attr(\"stroke\", \"#000\")\n                .attr(\"stroke-width\", 1.5)\n                .attr(\"stroke-linejoin\", \"round\")\n                .attr(\"d\", line);\n        }\n\n        // Color bar\n        const legendProps = {\n            title: this.props.colorBarTitle, tickSize: 6, width: 30, height: this.props.height,// + tickSize,\n            marginTop: 0, marginRight: 0, marginBottom: 0,// + tickSize,\n            marginLeft: 3, ticks: this.props.width / 64\n        };\n\n        function ramp(color, n = 256) {\n            const canvas = document.createElement(\"canvas\");\n            canvas.width = 1;\n            canvas.height = n;\n            const context = canvas.getContext(\"2d\");\n            for (let i = 0; i < n; ++i) {\n                context.fillStyle = color(i / (n - 1));\n                context.fillRect(0, n - 1 - i, 1, 1);\n            }\n            return canvas;\n        }\n\n        const n = Math.min(myColor.domain().length, myColor.range().length);\n        const xColorScale = myColor.copy().rangeRound(d3.quantize(d3.interpolate(legendProps.marginTop, legendProps.height - legendProps.marginBottom), n));\n        this.svg.append(\"image\")\n            .attr(\"x\", this.props.width + legendProps.marginLeft)\n            .attr(\"y\", legendProps.marginTop)\n            .attr(\"width\", legendProps.width - legendProps.marginLeft - legendProps.marginRight)\n            .attr(\"height\", legendProps.height - legendProps.marginTop - legendProps.marginBottom)\n            .attr(\"preserveAspectRatio\", \"none\")\n            .attr(\"xlink:href\", ramp(myColor.copy().domain(d3.quantize(d3.interpolate(0, 1), n))).toDataURL())\n            .style(\"opacity\", 0.5);\n        this.legendTitle = this.svg.append(\"g\")\n            .style(\"font\", this.props.fontSize + \"px times\")\n            .attr(\"transform\", 'translate(' + (this.props.width+legendProps.width) + ',0)') // myColor + legendProps.width\n            .call(d3.axisRight(xColorScale))\n            .call(g => g.select(\".domain\").remove())\n            .append(\"text\")\n            .attr(\"x\", -legendProps.width + legendProps.marginLeft)\n            .attr(\"y\", -5)\n            .attr(\"fill\", \"black\")\n            .attr(\"text-anchor\", \"start\")\n            .attr(\"font-size\", this.props.fontSize)\n            .text(legendProps.title);\n\n\n    }\n\n    update(props) {\n        this.props = props;\n        this.svg.selectAll('*').remove();\n        this.drawHeatmap();\n    }\n}"],"sourceRoot":""}